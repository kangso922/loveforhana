<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>하나의 그림 갤러리 🎨</title>
    <link rel="stylesheet" href="style.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet"/>
</head>
<body>
<div class="container">
    <div class="header-wrapper">
        <div class="music-button-wrapper">
            <button id="music-icon" class="music-button" onclick="document.getElementById('bgm').play()">🎵</button>
        </div>
        <h1>하나떵개의 그림들 ✨</h1>
    </div>


    <div class="gallery">
        <div class="item"><img src="images/image1.jpg" alt="그림 1"/></div>
        <div class="item"><img src="images/image2.jpg" alt="그림 2"/></div>
        <div class="item"><img src="images/image3.jpg" alt="그림 3"/></div>
        <div class="item"><img src="images/image4.jpg" alt="그림 4"/></div>
        <div class="item"><img src="images/image5.jpg" alt="그림 5"/></div>
        <div class="item"><img src="images/image6.jpg" alt="그림 6"/></div>
        <div class="item"><img src="images/image7.jpg" alt="그림 7"/></div>
        <div class="item"><img src="images/image8.jpg" alt="그림 8"/></div>
    </div>

    <!--<div class="music-control">
        <button onclick="document.getElementById('bgm').play()">🎵 음악 듣기</button>
    </div>-->
</div>

<!-- 모달 -->
<div class="modal" id="modal">
    <span class="close" id="close">×</span>
    <img class="modal-content" id="modal-img"/>
</div>

<audio id="bgm" loop>
    <source src="music/bgm.mp3" type="audio/mpeg"/>
    브라우저가 오디오를 지원하지 않습니다.
</audio>

<script>
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modal-img');
    const closeBtn = document.getElementById('close');

    document.getElementById('music-icon').addEventListener('click', () => {
        document.getElementById('bgm').play();
    });

    document.querySelectorAll('.item img').forEach(img => {
        img.addEventListener('click', () => {
            // 먼저 모달을 띄움
            modalImg.src = img.src;
            modal.style.display = 'flex';

            // 렌더링이 완료된 후 실행되어야 하므로 setTimeout 사용
            setTimeout(() => {
                const rect = modalImg.getBoundingClientRect();
                const scrollX = window.scrollX;
                const scrollY = window.scrollY;

                const imageX = rect.left + scrollX;
                const imageY = rect.top + scrollY;
                const imageWidth = rect.width;
                const imageHeight = rect.height;

                createHeartsFromBox(imageX, imageY, imageWidth, imageHeight);
                createParticlesFromBox(imageX, imageY, imageWidth, imageHeight);
            }, 0); // 다음 이벤트 루프에서 실행 (렌더링 완료 후)
        });
    });

    closeBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    function createHeartsFromBox(x, y, width, height) {
        fetch("images/heart-svgrepo-com.svg?cache=" + Date.now())
            .then(res => res.text())
            .then(svgText => {
                // width/height 제거
                let cleanedSvg = svgText
                    .replace(/<svg([^>]*)width="[^"]*"([^>]*)>/, '<svg$1$2>')
                    .replace(/<svg([^>]*)height="[^"]*"([^>]*)>/, '<svg$1$2>');

                // fill/stroke 수정
                cleanedSvg = cleanedSvg
                    .replace(/fill="none"/g, 'fill="#ff6b81"')
                    .replace(/stroke="#[^"]*"/g, 'stroke="none"');

                const centerX = x + width / 2;
                const centerY = y + height / 2;
                const maxRadius = Math.min(width, height) * 0.75;

                for (let i = 0; i < 10; i++) {
                    const angle = Math.random() * 2 * Math.PI;
                    const radius = Math.random() * maxRadius;

                    const offsetX = Math.cos(angle) * radius;
                    const offsetY = Math.sin(angle) * radius;

                    const posX = centerX + offsetX;
                    const posY = centerY + offsetY;

                    const wrapper = document.createElement("div");
                    wrapper.classList.add("floating-heart");
                    wrapper.style.position = "absolute";
                    wrapper.style.left = `${posX}px`;
                    wrapper.style.top = `${posY}px`;
                    wrapper.style.width = "32px";
                    wrapper.style.height = "32px";
                    wrapper.innerHTML = cleanedSvg;

                    document.body.appendChild(wrapper);
                    setTimeout(() => wrapper.remove(), 1500);
                }
            });
    }




    function createParticlesFromBox(x, y, width, height) {
        for (let i = 0; i < 12; i++) {
            const particle = document.createElement('div');
            particle.classList.add('particle');

            const angle = Math.random() * 2 * Math.PI;
            const radius = Math.random() * Math.min(width, height) * 0.75; // 이미지 크기에 비례

            const offsetX = Math.cos(angle) * radius;
            const offsetY = Math.sin(angle) * radius;


            const px = x + width / 2 + offsetX;
            const py = y + height / 2 + offsetY;

            particle.style.left = `${px}px`;
            particle.style.top = `${py}px`;
            particle.style.position = 'absolute';

            const moveAngle = Math.random() * 2 * Math.PI;
            const dist = Math.random() * 60 + 20;

            particle.style.setProperty('--dest-x', `${Math.cos(angle) * dist}px`);
            particle.style.setProperty('--dest-y', `${Math.sin(angle) * dist}px`);
            particle.style.background = ['#ffc1cc', '#ffd6e8', '#ffb3b3', '#ffe4ec'][Math.floor(Math.random() * 4)];

            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 800);
        }
    }

    function createPetal() {
        const petal = document.createElement("div");
        petal.classList.add("petal");
        petal.innerText = "🌸";

        const startLeft = Math.random() * window.innerWidth;
        const size = Math.random() * 14 + 12; // 12px ~ 26px
        const duration = Math.random() * 5 + 5; // 5s ~ 10s
        const delay = Math.random() * 5;
        const xDrift = Math.random() * 100 - 50 + "px";

        petal.style.left = `${startLeft}px`;
        petal.style.fontSize = `${size}px`;
        petal.style.animationDuration = `${duration}s`;
        petal.style.animationDelay = `${delay}s`;
        petal.style.setProperty('--x-drift', xDrift);

        document.body.appendChild(petal);

        setTimeout(() => petal.remove(), (duration + delay) * 1000);
    }

    // 일정 간격으로 계속 생성
    setInterval(createPetal, 500);

</script>
</body>
</html>
