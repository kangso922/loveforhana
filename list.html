<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!-- í•„ìˆ˜ Open Graph íƒœê·¸ë“¤ -->
    <meta property="og:title" content="í•˜ë‚˜ì˜ ê·¸ë¦¼ ê°¤ëŸ¬ë¦¬ ğŸ¨" />
    <meta property="og:description" content="í•˜ë‚˜ë–µê°œì˜ ê°ì„± ê°¤ëŸ¬ë¦¬ ğŸŒ¸ ì¡°ìš©íˆ ê°ìƒí•´ìš”." />
    <meta property="og:image" content="https://kangso922.github.io/loveforhana/images/image8.jpg" />
    <meta property="og:url" content="https://kangso922.github.io/" />
    <meta property="og:type" content="website" />
    <title>í•˜ë‚˜ì˜ ê·¸ë¦¼ ê°¤ëŸ¬ë¦¬ ğŸ¨</title>
    <link rel="stylesheet" href="style.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet"/>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J16EN3BDWW"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-J16EN3BDWW');
    </script>
</head>
<body>
<div class="player">
    <audio id="player" src="./uploads/music/bgm.mp3"></audio>
    <button onclick="togglePlay()" id="playPauseBtn" class="play">â™«</button>
    <div id="bar" class="bar"></div>
</div>
<div class="container">
    <h1>í•˜ë‚˜ë–µê°œì˜ ê·¸ë¦¼ë“¤ âœ¨ (í¬ë¡œí‚¤)</h1>
    <!-- í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
    <div class="hamburger" id="hamburger">â˜°</div>

    <!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
    <nav class="sidebar" id="sidebar">
        <ul>
            <li><a href="./index.html">ğŸ±ğŸ¶ ì›ì˜!</a></li>
            <li><a href="./list.html">ğŸ¨ í¬ë¡œí‚¤</a></li>
        </ul>
    </nav>

    <div class="gallery">
        <div class="item"><img src="./uploads/images/sketches/image1.jpg" alt="ê·¸ë¦¼ 1" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image2.jpg" alt="ê·¸ë¦¼ 2" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image3.jpg" alt="ê·¸ë¦¼ 3" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image4.jpg" alt="ê·¸ë¦¼ 4" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image5.jpg" alt="ê·¸ë¦¼ 5" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image6.jpg" alt="ê·¸ë¦¼ 6" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image7.jpg" alt="ê·¸ë¦¼ 7" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image8.jpg" alt="ê·¸ë¦¼ 8" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image9.jpg" alt="ê·¸ë¦¼ 9" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image10.jpg" alt="ê·¸ë¦¼ 10" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image11.jpg" alt="ê·¸ë¦¼ 11" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image12.jpg" alt="ê·¸ë¦¼ 12" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image13.jpg" alt="ê·¸ë¦¼ 13" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image14.jpg" alt="ê·¸ë¦¼ 14" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image15.jpg" alt="ê·¸ë¦¼ 15" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image16.jpg" alt="ê·¸ë¦¼ 16" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image17.jpg" alt="ê·¸ë¦¼ 17" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image18.jpg" alt="ê·¸ë¦¼ 18" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image19.jpg" alt="ê·¸ë¦¼ 19" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image20.jpg" alt="ê·¸ë¦¼ 20" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image21.jpg" alt="ê·¸ë¦¼ 21" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image22.jpg" alt="ê·¸ë¦¼ 22" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image23.jpg" alt="ê·¸ë¦¼ 23" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image24.jpg" alt="ê·¸ë¦¼ 24" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image25.jpg" alt="ê·¸ë¦¼ 25" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image26.jpg" alt="ê·¸ë¦¼ 26" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image27.jpg" alt="ê·¸ë¦¼ 27" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image28.jpg" alt="ê·¸ë¦¼ 28" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image29.jpg" alt="ê·¸ë¦¼ 29" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image30.jpg" alt="ê·¸ë¦¼ 30" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image31.jpg" alt="ê·¸ë¦¼ 31" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image32.jpg" alt="ê·¸ë¦¼ 32" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image33.jpg" alt="ê·¸ë¦¼ 33" loading="lazy"/></div>
        <div class="item"><img src="./uploads/images/sketches/image34.jpg" alt="ê·¸ë¦¼ 34" loading="lazy"/></div>

    </div>
</div>

<!-- ëª¨ë‹¬ -->
<div class="modal" id="modal">
    <span class="close" id="close">Ã—</span>
    <img class="modal-content" id="modal-img"/>
</div>

<audio id="bgm" loop>
    <source src="./uploads/music/bgm.mp3" type="audio/mpeg"/>
    ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
</audio>

<script>
    // --- ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modal-img');
    const closeBtn = document.getElementById('close');
    const audio = document.getElementById("player");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const bar = document.getElementById("bar");
    const hamburger = document.getElementById('hamburger');
    const sidebar = document.getElementById('sidebar');

    // --- ì „ì—­ ë³€ìˆ˜ ---
    let scrollY = 0;
    let petalIntervalId = null; // ë²šê½ƒ ìƒì„± interval ID

    // --- ìš”ì†Œ ì¡´ì¬ í™•ì¸ (ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘ ì‹œ) ---
    if (!audio) console.error("CRITICAL: Audio element #player not found!");
    if (!playPauseBtn) console.error("CRITICAL: Button #playPauseBtn not found!");
    if (!bar) console.error("CRITICAL: Div #bar not found!");
    if (!modal) console.error("CRITICAL: Div #modal not found!");
    if (!modalImg) console.error("CRITICAL: Img #modal-img not found!");
    if (!closeBtn) console.error("CRITICAL: Span #close not found!");



    hamburger.addEventListener('click', () => {
        sidebar.classList.toggle('active');
    });

    // --- ëª¨ë‹¬ ì—´ê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    document.querySelectorAll('.item img').forEach(img => {
        img.addEventListener('click', () => {
            if (!modal || !modalImg) return; // ìš”ì†Œ ì—†ìœ¼ë©´ ì¤‘ë‹¨

            // ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ íš¨ê³¼ ìƒì„±
            modalImg.onload = () => {
                console.log("[Web] Modal image loaded:", modalImg.src);
                const rect = modalImg.getBoundingClientRect();
                createHeartsFromBox(rect.left, rect.top, rect.width, rect.height);
                createParticlesFromBox(rect.left, rect.top, rect.width, rect.height);
                modalImg.onload = null; modalImg.onerror = null;
            };
            modalImg.onerror = () => {
                console.error("Failed to load modal image:", modalImg.src);
                modalImg.onload = null; modalImg.onerror = null;
            };

            modalImg.src = img.src; // src ì„¤ì •
            scrollY = window.scrollY; // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥

            // body ê³ ì •
            document.body.style.position = 'fixed';
            document.body.style.top = `-${scrollY}px`;
            document.body.style.left = '0'; document.body.style.right = '0'; document.body.style.width = '100%';

            modal.style.display = 'flex'; // ëª¨ë‹¬ í‘œì‹œ

            // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì €ì¥
            sessionStorage.setItem('scrollY', scrollY);
            sessionStorage.setItem('isModalOpen', 'true');
            sessionStorage.setItem('modalImage', img.src);
            console.log("[Web] Modal opened, state saved.");
        });
    });

    // --- ëª¨ë‹¬ ë‹«ê¸° ---
    function closeModal() {
        if (!modal) return;
        modal.style.display = 'none';
        document.body.style.position = ''; document.body.style.top = '';
        document.body.style.left = ''; document.body.style.right = ''; document.body.style.width = '';
        requestAnimationFrame(() => window.scrollTo(0, scrollY)); // ìŠ¤í¬ë¡¤ ë³µì›
        sessionStorage.setItem('isModalOpen', 'false'); // ìƒíƒœ ì €ì¥
        console.log("[Web] Modal closed, state saved.");
    }
    if (closeBtn) closeBtn.addEventListener('click', closeModal);
    if (modal) modal.addEventListener('click', (event) => { if (event.target === modal) closeModal(); });


    // --- í•˜íŠ¸/íŒŒí‹°í´/ë²šê½ƒì ìƒì„± í•¨ìˆ˜ë“¤ (ì›ë³¸ ìœ ì§€) ---
    function createHeartsFromBox(x, y, width, height) { /* ... ì›ë³¸ ì½”ë“œì™€ ë™ì¼ ... */
        fetch("/static/images/heart-svgrepo-com.svg?cache=" + Date.now())
            .then(res => { if (!res.ok) throw new Error('Network response was not ok'); return res.text(); })
            .then(svgText => {
                let cleanedSvg = svgText.replace(/<svg([^>]*)width="[^"]*"([^>]*)>/, '<svg$1$2>').replace(/<svg([^>]*)height="[^"]*"([^>]*)>/, '<svg$1$2>').replace(/fill="none"/g, 'fill="#ff6b81"').replace(/stroke="#[^"]*"/g, 'stroke="none"');
                const centerX = x + width / 2; const centerY = y + height / 2; const maxRadius = Math.min(width, height) * 0.6;
                for (let i = 0; i < 10; i++) { const angle = Math.random()*2*Math.PI; const radius = Math.random()*maxRadius; const offsetX = Math.cos(angle)*radius; const offsetY = Math.sin(angle)*radius; const posX = centerX+offsetX; const posY = centerY+offsetY; const wrapper = document.createElement("div"); wrapper.classList.add("floating-heart"); wrapper.style.position = "fixed"; wrapper.style.left = `${posX}px`; wrapper.style.top = `${posY}px`; wrapper.style.width = "32px"; wrapper.style.height = "32px"; wrapper.innerHTML = cleanedSvg; document.body.appendChild(wrapper); setTimeout(() => wrapper.remove(), 1500); }
            }).catch(error => console.error("Heart SVG Error:", error));
    }
    function createParticlesFromBox(x, y, width, height) { /* ... ì›ë³¸ ì½”ë“œì™€ ë™ì¼ ... */
        for (let i = 0; i < 12; i++) { const particle = document.createElement('div'); particle.classList.add('particle'); const angle = Math.random()*2*Math.PI; const radius = Math.random()*Math.min(width, height)*0.6; const offsetX = Math.cos(angle)*radius; const offsetY = Math.sin(angle)*radius; const px = x+width/2+offsetX; const py = y+height/2+offsetY; particle.style.left = `${px}px`; particle.style.top = `${py}px`; particle.style.position = 'fixed'; const moveAngle = Math.random()*2*Math.PI; const dist = Math.random()*60+20; particle.style.setProperty('--dest-x', `${Math.cos(moveAngle)*dist}px`); particle.style.setProperty('--dest-y', `${Math.sin(moveAngle)*dist}px`); particle.style.background = ['#ffc1cc', '#ffd6e8', '#ffb3b3', '#ffe4ec'][Math.floor(Math.random()*4)]; document.body.appendChild(particle); setTimeout(() => particle.remove(), 800); }
    }
    function createPetal() { /* ... ì›ë³¸ ì½”ë“œì™€ ë™ì¼ ... */
        const petal = document.createElement("div"); petal.classList.add("petal"); petal.innerText = "ğŸŒ¸"; const startLeft = Math.random()*window.innerWidth; const size = Math.random()*14+12; const duration = Math.random()*5+5; const delay = Math.random()*5; const xDrift = Math.random()*100-50+"px"; petal.style.left = `${startLeft}px`; petal.style.fontSize = `${size}px`; petal.style.animationDuration = `${duration}s`; petal.style.animationDelay = `${delay}s`; petal.style.setProperty('--x-drift', xDrift); document.body.appendChild(petal); setTimeout(() => petal.remove(), (duration+delay)*1000);
    }


    // --- ì˜¤ë””ì˜¤ ì¬ìƒ/ì¼ì‹œì •ì§€ í† ê¸€ ë° ìƒíƒœ **ì €ì¥** ---
    function togglePlay() {
        if (!audio) return; // ì•ˆì „ ì¥ì¹˜
        if (audio.paused) {
            console.log('[Web] togglePlay: Attempting to play audio...');
            audio.play().then(() => {
                console.log('[Web] togglePlay: Play successful.');
                playPauseBtn.textContent = "âšâš"; bar.style.display = "block";
                // !!! ìƒíƒœ ì €ì¥ !!!
                sessionStorage.setItem('audioPaused', 'false');
                sessionStorage.setItem('audioTime', audio.currentTime);
            }).catch(error => {
                console.error("[Web] togglePlay: Play failed:", error);
                playPauseBtn.textContent = "â™«"; bar.style.display = "none";
                // ì‹¤íŒ¨ ì‹œ 'ì¼ì‹œì •ì§€' ìƒíƒœë¡œ ì €ì¥
                sessionStorage.setItem('audioPaused', 'true');
                // ì‹¤íŒ¨í•´ë„ ì‹œê°„ì€ ì €ì¥í•  ìˆ˜ ìˆìŒ
                // sessionStorage.setItem('audioTime', audio.currentTime);
            });
        } else {
            console.log('[Web] togglePlay: Attempting to pause audio...');
            audio.pause(); playPauseBtn.textContent = "â™«"; bar.style.display = "none";
            // !!! ìƒíƒœ ì €ì¥ !!!
            sessionStorage.setItem('audioPaused', 'true');
            sessionStorage.setItem('audioTime', audio.currentTime);
            console.log('[Web] togglePlay: Audio paused, state saved.');
        }
    }
    // ì¤‘ìš”: ë²„íŠ¼ì— onclick="togglePlay()" ê°€ HTMLì— ì´ë¯¸ ìˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” addEventListener ë¶ˆí•„ìš”
    // playPauseBtn?.addEventListener('click', togglePlay);


    // --- ìƒíƒœ ë³µì› í•¨ìˆ˜ (!!! ìœ ì¼í•œ ì •ì˜, ì˜¤ë””ì˜¤ í¬í•¨ !!!) ---
    function restoreAppState() {
        console.log('[Web] +++++ restoreAppState START +++++');
        try {
            // 1. ê°’ ì½ê¸° (ìƒì„¸ ë¡œê¹…)
            const lastScroll = sessionStorage.getItem('scrollY');
            const isModalOpen = sessionStorage.getItem('isModalOpen');
            const modalImage = sessionStorage.getItem('modalImage');
            const audioPaused = sessionStorage.getItem('audioPaused'); // ì €ì¥ëœ ê°’ ì½ê¸°
            const audioTime = sessionStorage.getItem('audioTime');   // ì €ì¥ëœ ê°’ ì½ê¸°
            console.log('[Web] 1. Read from sessionStorage:', { lastScroll, isModalOpen, modalImage, audioPaused, audioTime });

            // 2. ìŠ¤í¬ë¡¤ ë³µì› (ìƒì„¸ ë¡œê¹…)
            if (lastScroll) {
                const scrollVal = parseInt(lastScroll);
                console.log('[Web] 2. Attempting scroll restore to:', scrollVal);
                setTimeout(() => { window.scrollTo(0, scrollVal); console.log('[Web] 2. Scroll restoration attempted. Current scrollY:', window.scrollY); }, 100);
            } else { console.log('[Web] 2. No saved scroll position.'); }

            // 3. ëª¨ë‹¬ ë³µì› (ìƒì„¸ ë¡œê¹…)
            console.log('[Web] 3. Checking modal state...');
            if (isModalOpen === 'true' && modalImage) {
                console.log('[Web] 3.1. Attempting to restore modal.');
                modalImg.onload = () => { /* ... ì´ì „ê³¼ ë™ì¼ ... */ console.log('[Web] 3.2. Modal image loaded.'); modal.style.display = 'flex'; document.body.style.position = 'fixed'; const topOffset = `-${lastScroll || 0}px`; document.body.style.top = topOffset; document.body.style.left = '0'; document.body.style.right = '0'; document.body.style.width = '100%'; console.log('[Web] 3.3. Modal displayed and body fixed. Top:', topOffset); modalImg.onload = null; modalImg.onerror = null; };
                modalImg.onerror = () => { console.error("[Web] 3.E. Failed to load modal image for restoration:", modalImage); modalImg.onload = null; modalImg.onerror = null; };
                modalImg.src = modalImage; console.log('[Web] 3.4. Modal image src set.');
            } else {
                console.log('[Web] 3.5. Ensuring modal is closed.');
                modal.style.display = 'none'; document.body.style.position = ''; document.body.style.top = ''; document.body.style.left = ''; document.body.style.right = ''; document.body.style.width = '';
            }

            // 4. ì˜¤ë””ì˜¤ ë³µì› (!!! í•µì‹¬ !!! ìƒì„¸ ë¡œê¹… í¬í•¨)
            console.log('[Web] 4. Checking audio state. audioPaused from storage:', audioPaused);
            if (audio) {
                const targetTime = audioTime ? parseFloat(audioTime) : 0;
                console.log('[Web] 4.1. Target audio time:', targetTime);
                console.log('[Web] 4.2. Audio properties BEFORE restore attempt:', { src: audio.src, currentTime: audio.currentTime, duration: audio.duration, readyState: audio.readyState, networkState: audio.networkState, error: audio.error, paused: audio.paused });

                // currentTime ì„¤ì •
                if (audio.readyState >= 1) {
                    try { audio.currentTime = targetTime; } catch(e){ console.error("Error setting currentTime:", e); }
                } else {
                    audio.onloadedmetadata = () => { try { audio.currentTime = targetTime; } catch(e){ console.error("Error setting currentTime (onloadedmetadata):", e); } audio.onloadedmetadata = null; }
                }
                console.log('[Web] 4.2. Set audio currentTime attempted. Current:', audio.currentTime);


                // ì¬ìƒ/ì¼ì‹œì •ì§€ ìƒíƒœ ë³µì›
                if (audioPaused === 'false') { // ì €ì¥ëœ ìƒíƒœê°€ 'ì¬ìƒ ì¤‘' ì´ì—ˆì–´ì•¼ í•¨
                    console.log('[Web] 4.3. Attempting to call audio.play() for restore...');
                    const playPromise = audio.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('[Web] 4.4. Audio play() Promise resolved (Restore Success).');
                            playPauseBtn.textContent = "ğŸ”‡"; bar.style.display = "block";
                        }).catch(error => {
                            // ìë™ ì¬ìƒ ì œí•œ ë“±ìœ¼ë¡œ ì‹¤íŒ¨ ì‹œ
                            console.error("[Web] 4.E. !!! Audio play() Promise rejected during restore !!!", error);
                            playPauseBtn.textContent = "â™«"; bar.style.display = "none";
                            // ì‹¤íŒ¨ ì‹œ sessionStorage ê°’ë„ 'ì¼ì‹œì •ì§€'ë¡œ ì—…ë°ì´íŠ¸ í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŒ
                            sessionStorage.setItem('audioPaused', 'true');
                        });
                    } else { console.warn("[Web] 4.W. audio.play() did not return a Promise during restore."); playPauseBtn.textContent = "ğŸ”‡"; bar.style.display = "block"; }
                } else { // ì €ì¥ëœ ìƒíƒœê°€ 'ì¼ì‹œì •ì§€' ì´ê±°ë‚˜ null ì´ë©´
                    console.log('[Web] 4.5. Setting audio to paused for restore.');
                    audio.pause(); playPauseBtn.textContent = "â™«"; bar.style.display = "none";
                }
            } else { console.warn("[Web] 4.W. Audio element #player not found during restore."); }
        } catch (error) { console.error('[Web] !!!!! CRITICAL Error inside restoreAppState !!!!!', error, error.stack);
        } finally { console.log('[Web] ----- restoreAppState END -----'); }
    }

    // --- í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ì²˜ë¦¬ ---
    function handleVisibilityChange() {
        if (document.hidden) {
            console.log("Page is hidden");
            if (petalIntervalId) { clearInterval(petalIntervalId); petalIntervalId = null; console.log("Petal interval cleared."); }
            // ì„ íƒì : í˜ì´ì§€ ìˆ¨ê¹€ ì‹œ ì˜¤ë””ì˜¤ ì¼ì‹œì •ì§€ ë° ìƒíƒœ ì €ì¥
            // if (audio && !audio.paused) {
            //     audio.pause();
            //     playPauseBtn.textContent = "â™«"; bar.style.display = "none";
            //     sessionStorage.setItem('audioPaused', 'true');
            //     sessionStorage.setItem('audioTime', audio.currentTime);
            //     console.log("Audio paused and state saved due to page hidden.");
            // }
        } else {
            console.log("Page is visible");
            if (!petalIntervalId) { petalIntervalId = setInterval(createPetal, 500); console.log("Petal interval restarted."); }
            // ì„ íƒì : í˜ì´ì§€ ë³´ì¼ ë•Œ ìƒíƒœ ë³µì› ì¬ì‹œë„ (í•„ìš”ì— ë”°ë¼)
            // restoreAppState();
        }
    }
    document.addEventListener("visibilitychange", handleVisibilityChange);

    // --- ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥ ---
    window.addEventListener('scroll', () => {
        if (document.body.style.position !== 'fixed') { sessionStorage.setItem('scrollY', window.scrollY); }
    });

    // --- í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ---
    window.addEventListener('load', () => {
        console.log("Page finished loading.");
        // ë¶ˆí•„ìš” í”ŒëŸ¬í„° í†µì‹  ì½”ë“œ ì œê±°ë¨
    });

    // --- ì „ì—­ ì˜¤ë¥˜ í•¸ë“¤ëŸ¬ ---
    window.onerror = function(message, source, lineno, colno, error) { console.error("[Web] Global Uncaught Error:", { message, source, lineno, colno, errorObject: error }); };
    window.addEventListener('unhandledrejection', function(event) { console.error('[Web] Global Unhandled Promise Rejection:', event.reason); });

    // --- ì•ˆë“œë¡œì´ë“œì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡ í•¨ìˆ˜ ì „ì—­ ë…¸ì¶œ ---
    window.restoreAppState = restoreAppState;

    // --- ìµœì´ˆ ë²šê½ƒ ìƒì„± ì‹œì‘ ---
    if (!petalIntervalId) { petalIntervalId = setInterval(createPetal, 500); }

    // !!! ìŠ¤í¬ë¦½íŠ¸ ë ë¶€ë¶„ì˜ ì¤‘ë³µ restoreAppState í•¨ìˆ˜ ì •ì˜ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤ !!!

</script>
</body>
</html>
